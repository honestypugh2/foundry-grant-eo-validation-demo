# Scoring System Documentation

## Overview

The Grant Proposal Compliance System uses three distinct scores to evaluate proposals and guide decision-making:

1. **Confidence Score** - How certain the AI is about its analysis
2. **Compliance Score** - How well the proposal aligns with executive orders
3. **Risk Score** - Overall assessment of proposal risk based on multiple factors

---

## 1. Confidence Score (0-100)

### Purpose
Measures the AI's certainty in its compliance analysis. This score indicates how reliable the AI believes its recommendations are.

### Source
Generated by the **ComplianceAgent** during analysis of grant proposals against executive orders.

### Calculation
- **Extracted from AI response** - The agent provides a confidence score based on:
  - Clarity of executive order requirements
  - Specificity of grant proposal content
  - Quality and relevance of knowledge base matches
  - Ambiguity in the analysis
- **Default: 70%** if not explicitly stated

### Score Ranges

| Range | Interpretation | Meaning |
|-------|---------------|---------|
| **90-100** | Very High Confidence | AI is very certain about its analysis. Clear executive orders, specific proposal language, strong knowledge base matches. |
| **70-89** | High Confidence | AI is confident in most findings. Some minor ambiguities may exist. |
| **50-69** | Moderate Confidence | Significant uncertainty exists. Manual review strongly recommended. |
| **Below 50** | Low Confidence | AI cannot reliably analyze. Requires immediate human expert review. |

### Decision Guidelines

**Confidence ≥ 90%:**
- AI analysis is highly reliable
- Can proceed with standard attorney review
- Low priority for immediate attention

**Confidence 70-89%:**
- AI analysis is generally reliable
- Standard attorney review process
- May require additional clarification on specific points

**Confidence 50-69%:**
- AI analysis has significant uncertainty
- **Priority: Medium-High**
- Senior attorney review recommended
- May require additional research or clarification

**Confidence < 50%:**
- AI analysis is unreliable
- **Priority: Critical**
- Immediate expert review required
- Do not rely on AI recommendations without verification

### Example Usage

```python
if result['confidence_score'] < 60:
    # Flag for immediate human review
    send_priority_notification()
    add_to_high_priority_queue()
else:
    # Standard processing
    add_to_review_queue()
```

### Impact on Risk Score
- Low confidence scores **increase risk** (see Risk Score section)
- Confidence < 60% applies a 10% penalty to risk calculation
- Ensures high-uncertainty proposals receive appropriate scrutiny

---

### 2. **Compliance Score** (0-100)

**Purpose**: Measures how well the grant proposal aligns with relevant executive orders and compliance requirements.

**Source**: Generated by the **ComplianceAgent** as the primary output of executive order analysis.

**Current Implementation Note**: In the current version, `confidence_score` (from ComplianceAgent) is used as a proxy for compliance assessment. This represents the AI's certainty in its compliance analysis rather than a separate compliance metric.

**Calculation**:
- Based on AI's assessment of proposal compliance with executive orders
- Considers:
  - Number and severity of violations found
  - Alignment with executive order requirements
  - Presence of prohibited content or activities
  - Compliance with mandatory requirements

### Score Ranges

| Range | Status | Interpretation |
|-------|--------|---------------|
| **90-100** | Compliant | Proposal meets all requirements. Minor clarifications may be needed. |
| **75-89** | Mostly Compliant | Generally compliant with some minor issues to address. |
| **60-74** | Requires Review | Significant concerns exist. Modifications likely needed. |
| **Below 60** | Non-Compliant | Major violations detected. Substantial revision required. |

### Decision Guidelines

**Compliance ≥ 90%:**
- **Status: Compliant**
- **Action: Approve** with standard attorney validation
- Minor documentation clarifications if any
- Low risk of rejection

**Compliance 75-89%:**
- **Status: Mostly Compliant**
- **Action: Approve with Conditions**
- Address specific identified issues
- Attorney should verify corrective actions
- Moderate review time required

**Compliance 60-74%:**
- **Status: Requires Review**
- **Action: Request Revisions**
- Multiple compliance issues present
- Department must revise and resubmit
- Senior attorney review recommended

**Compliance < 60%:**
- **Status: Non-Compliant**
- **Action: Reject or Major Revision Required**
- Fundamental compliance issues
- Substantial rework needed
- May not be feasible to proceed without major changes

### Example Usage

```python
if compliance_score >= 90:
    status = "Compliant - Approved"
    action = "Standard attorney validation"
elif compliance_score >= 75:
    status = "Mostly Compliant - Conditional Approval"
    action = "Address minor issues then proceed"
elif compliance_score >= 60:
    status = "Requires Review"
    action = "Request revisions from department"
else:
    status = "Non-Compliant"
    action = "Reject or require major revision"
```

### Relationship to Violations
- Each violation **reduces** the compliance score
- High-severity violations have larger impact
- Multiple violations compound the effect

---

## 3. Risk Score (0-100)

### Purpose
Comprehensive assessment of proposal risk considering compliance, document quality, and completeness. Used to prioritize attorney workload and trigger notifications.

### Source
Generated by the **RiskScoringAgent** by combining multiple risk factors.

### Calculation

The risk score is a **weighted average** of three components:

```
Risk Score = (Compliance Risk × 60%) + (Quality Risk × 25%) + (Completeness Risk × 15%)
```

#### Component Breakdown

**Compliance Risk (60% weight):**
- Based on compliance score and confidence
- Formula: `compliance_score × (confidence_score / 100)`
- Violations and warnings reduce this score
- Low confidence (< 60%) applies additional 10% penalty

**Quality Risk (25% weight):**
- Starts at 100, deductions for:
  - Word count < 500: -30 points
  - Word count < 1000: -15 points
  - Page count < 2: -10 points
  - Key topics < 3: -20 points

**Completeness Risk (15% weight):**
- Starts at 100, deductions for:
  - Key clauses < 3: -25 points
  - No relevant EOs found: -40 points
  - Only 1 relevant EO: -20 points

### Score Ranges and Risk Levels

| Risk Score | Risk Level | Interpretation |
|------------|-----------|---------------|
| **90-100** | Low | Proposal is low risk. Standard processing. |
| **75-89** | Medium | Moderate concerns. Standard attorney review. |
| **60-74** | Medium-High | Significant concerns. Priority review needed. |
| **Below 60** | High | Critical issues. Immediate attention required. |

### Decision Guidelines

**Risk Score ≥ 90% (Low Risk):**
- **Priority: Normal**
- **Email Notification: No**
- Standard queue processing
- Single attorney review sufficient
- Timeline: Process within standard SLA

**Risk Score 75-89% (Medium Risk):**
- **Priority: Normal**
- **Email Notification: No**
- Standard processing with attention to flagged issues
- May require additional documentation
- Timeline: Standard SLA

**Risk Score 60-74% (Medium-High Risk):**
- **Priority: High**
- **Email Notification: Yes**
- Expedited review queue
- Senior attorney review recommended
- Timeline: Process within 24-48 hours

**Risk Score < 60% (High Risk):**
- **Priority: Critical**
- **Email Notification: Yes (Immediate)**
- Immediate attorney notification
- Expert review required
- Timeline: Review within 24 hours
- May require legal department manager involvement

### Email Notification Triggers

Automatic email notifications are sent when:
- Risk Score < 75% (Medium threshold)
- Risk Level = "High" or "Medium-High"

Notification includes:
- Risk score and level
- Compliance score and status
- Confidence score
- Specific violations and concerns
- Recommendations for action

### Example Usage

```python
risk_report = risk_agent.calculate_risk_score(compliance_report, summary, metadata)

if risk_report['overall_score'] < 60:
    # High risk - immediate action
    send_urgent_notification()
    assign_to_senior_attorney()
    flag_for_manager_review()
elif risk_report['overall_score'] < 75:
    # Medium-high risk - priority processing
    send_notification()
    add_to_priority_queue()
else:
    # Normal processing
    add_to_standard_queue()
```

---

## Scoring Logic Verification

### Is the Scoring Logic Appropriate?

✅ **YES - The scoring logic is well-designed for this use case:**

#### Strengths

1. **Three-Dimensional Assessment**
   - Confidence captures AI uncertainty
   - Compliance measures regulatory alignment
   - Risk provides holistic view combining multiple factors

2. **Appropriate Weighting**
   - Compliance (60%) is the primary concern - correct priority
   - Quality (25%) ensures document completeness
   - Completeness (15%) validates thorough analysis

3. **Clear Thresholds**
   - Defined breakpoints (90, 75, 60) create actionable categories
   - Aligned with typical approval workflows
   - Easy for attorneys to understand and apply

4. **Conservative Bias**
   - Low confidence reduces risk score (increases caution)
   - Multiple violations compound risk appropriately
   - Err on side of caution for legal compliance

5. **Notification Logic**
   - Risk < 75% triggers notification - appropriate threshold
   - Ensures attorneys are alerted to problematic proposals
   - Prevents low-quality proposals from slipping through

#### Potential Improvements

1. **Confidence Score Calibration**
   - Currently extracted from AI text (may be inconsistent)
   - **Recommendation:** Use structured outputs or JSON mode for consistent scoring
   - **Alternative:** Calculate confidence based on objective metrics (search result scores, EO match strength)

2. **Compliance Score Granularity**
   - Currently AI-generated (subjective)
   - **Recommendation:** Consider algorithmic scoring based on:
     - Number of violations (weighted by severity)
     - Percentage of requirements met
     - Executive order coverage completeness

3. **Risk Score Validation**
   - **Recommendation:** Track historical outcomes and calibrate thresholds
   - Compare AI risk scores with attorney final decisions
   - Adjust weights based on which factors best predict issues

4. **Quality Metrics**
   - Word/page counts are crude measures
   - **Recommendation:** Add metrics for:
     - Presence of required sections (budget, timeline, objectives)
     - Citation quality and specificity
     - Readability and clarity scores

---

## Decision-Making Workflow

### For Attorneys

```
1. Check Risk Score
   ├─ High Risk (< 60): Review immediately, verify all findings
   ├─ Medium-High (60-74): Priority review, focus on flagged issues
   └─ Low/Medium (≥ 75): Standard review process

2. Check Confidence Score
   ├─ Low (< 60): Do not trust AI analysis, perform full manual review
   ├─ Medium (60-89): Verify key findings, use AI as guide
   └─ High (≥ 90): AI analysis reliable, focus on validation

3. Check Compliance Score
   ├─ Non-Compliant (< 60): Reject or require major revision
   ├─ Requires Review (60-74): Request specific corrections
   ├─ Mostly Compliant (75-89): Minor modifications needed
   └─ Compliant (≥ 90): Approve with standard validation

4. Review Specific Findings
   - Examine cited executive orders
   - Verify violations flagged by AI
   - Check completeness of analysis

5. Make Final Decision
   - Approve, Reject, or Request Revisions
   - Document attorney review and rationale
   - Provide feedback for continuous improvement
```

### For Department Submitters

```
1. Before Submission
   - Ensure document is complete (> 1000 words recommended)
   - Include all required sections
   - Review relevant executive orders

2. After AI Analysis
   - If Confidence < 70%: Document may need clarification
   - If Compliance < 75%: Review flagged issues before attorney review
   - If Risk is High: Expect detailed attorney scrutiny

3. If Revisions Requested
   - Address each cited violation
   - Provide specific responses to concerns
   - Resubmit with changes highlighted
```

---

## Score Interpretation Quick Reference

| Metric | Excellent | Good | Fair | Poor |
|--------|-----------|------|------|------|
| **Confidence** | 90-100 | 70-89 | 50-69 | < 50 |
| **Compliance** | 90-100 | 75-89 | 60-74 | < 60 |
| **Risk** | 90-100 | 75-89 | 60-74 | < 60 |

### Combined Score Scenarios

| Compliance | Confidence | Typical Risk | Recommendation |
|------------|-----------|-------------|----------------|
| High (90+) | High (90+) | Low | Approve with validation |
| High (90+) | Low (< 60) | Medium | Verify AI analysis before approving |
| Medium (75-89) | High (90+) | Medium | Address minor issues, then approve |
| Medium (75-89) | Low (< 60) | High | Manual review required |
| Low (< 60) | High (90+) | High | Reject or major revision needed |
| Low (< 60) | Low (< 60) | High | Unreliable analysis, manual review critical |

---

## Implementation Notes

### Current Implementation

**ComplianceAgent (`compliance_agent.py`):**
- Generates confidence_score (extracted from AI text)
- Returns compliance status (Compliant/Non-Compliant/Requires Review)
- Compliance score derived from confidence score (used as proxy)

**RiskScoringAgent (`risk_scoring_agent.py`):**
- Calculates comprehensive risk score
- Combines compliance, quality, and completeness
- Applies weighted formula with appropriate thresholds

**Orchestrator (`orchestrator.py`):**
- Coordinates agent workflow
- Maps compliance_analysis confidence_score to compliance_report compliance_score
- Passes data to risk scoring agent

### Validation Status

✅ **Scoring logic is appropriate and well-designed**
✅ **Thresholds are reasonable for legal compliance use case**
✅ **Weighting prioritizes compliance correctly**
✅ **Conservative bias appropriate for legal context**

### Recommendations for Enhancement

1. **Add score calibration tracking**
2. **Implement structured output for confidence scores**
3. **Track attorney agreement rates with AI scores**
4. **Periodically adjust thresholds based on outcomes**
5. **Add historical comparison to previous proposals**

---

## Summary

The three-score system provides a comprehensive, multi-dimensional assessment:

- **Confidence Score** - Trust the AI analysis?
- **Compliance Score** - Does it meet requirements?
- **Risk Score** - How urgent is attorney review?

Together, these scores enable:
- Prioritized attorney workload
- Appropriate notification triggers
- Clear decision-making criteria
- Continuous quality improvement

The current implementation is sound and appropriate for the grant proposal compliance use case.
